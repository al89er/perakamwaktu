<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="config.js"></script>

<script>
  // Now these are loaded from config.js:
  // SUPABASE_URL
  // SUPABASE_ANON_KEY
  // DEVICE_ID

  const sb = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
  const statusEl = document.getElementById("status");
  
  function setStatus(msg) { statusEl.textContent = msg; }

  async function sendCmd(cmd, args = {}) {
    setStatus("Sending: " + cmd + " …");

    const { error } = await sb.from("commands").insert([
      { device_id: DEVICE_ID, cmd, args }
    ]);

    if (error) {
      console.error(error);
      setStatus("❌ Error: " + error.message);
    } else {
      setStatus("✔️ Sent: " + cmd + " at " + new Date().toLocaleTimeString());
    }
  }

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("sw.js").catch(console.error);
  }
</script>
